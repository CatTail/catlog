/*
 Title: using-closure-tools-build-webpage
 Date: 2012-02-10 22:17:09
 Tags: tag
 Category: category
 Author: CatTail
*/

## 使用CLOSURE TOOLS构建网页插件的三种环境

### 本文介绍如何在使用closure tools构建网页插件时如何去构建开发，测试和部署环境


本文介绍的网页插件主要以书签以及各类浏览器插件的最终形式存在。在插件开发，测试和部署的生命周期中，如何简单，高效的完成功能并解决问题是本文的中心。

### 开发环境

如果使用其他的Javascript库(如jQuery)来构建网页插件，那么构建开发环境非常简单。只需要在构建一个加载依赖库的加载器就可以了。但是由于使用closure library,它的模块加载需要在页面的document还未构建完成前才能正常工作。这意味着我们需要对这个页面拥有控制权，然而，这里的难点就来了，由于我们开发的是网页插件，对宿主页面没有控制权，所以不能完成closure library的模块加载。

难道这意味着我们只能手工编写模仿测试页面，而不能在真正的宿主页面完成开发吗？事实上并不是这样的，closure library的模块加载机制在base.js中实现，主要通过构建依赖关系，并加载相应模块完成。它通过下图方式加载新的模块：

由于通过doc.write来加载模块，所以才有了要求document加载完成前进行模块加载的要求，因此，在这里已经有了两种解决方案。

1. 修改加载代码来加载新的模块。

2. 使用包括frame或者浏览器插件的方式来加载预定义的自己定义的网页，然后从该网页已经加载完成的sciprt列表中或许相应的加载顺序，接着在宿主页面完成相同顺序的加载。

上述方法中方法2已经实现，测试通过并且应用与开发环境。方法一拥有更大的灵活性，支持更多的浏览器，但是有一个小问题，由于模块加载的依赖关系，需要在依赖模块加载完成后再加载后续模块。这里需要同步的加载异步模块。
